---
id: code
title: Code Block
sidebar_label: Code
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

![Code Block Screenshot](./assets/code-block.png)

## Overview

The Code Block allows you to run arbitrary JavaScript code during your flow's execution. This can be useful for a variety of purposes, such as:

- Performing complex calculations
- Custom, domain-specific logic that is complex to represent in Lawme blocks alone
- Using JavaScript functions that are not available in other blocks

### Code Inputs

The inputs to the code block are accessible in the special variable `inputs`. To access the input named `foo`, it is accessible on `inputs.foo`.

All inputs have the following structure:

```ts
{
  type: string;
  value: any;
}
```

The `type` of each input corresponds to a [Data Type](../user-guide/workflow/data-types.md). The `value` is the actual value of the input.

For example, if you have an input named `myNumber` that is a number, you can access it in the code block like this:

```js
const foo = inputs.myNumber.value; // inputs.myNumber.type === 'number'
```

### Code Outputs

The code block **must** `return` an object containing the output values. Each property of the output object must correspond to one of the configured output names in the editor.

Each of the values of the properties must be an object with the `{type: DataType; value: any}` structure described above.

For example, if you have an output named `myNumber` that is a number, you can return it like this:

```js
return {
  myNumber: {
    type: 'number',
    value: 123,
  },
};
```

<Tabs
  defaultValue="inputs"
  values={[
    {label: 'Inputs', value: 'inputs'},
    {label: 'Outputs', value: 'outputs'},
    {label: 'Editor Settings', value: 'settings'},
  ]
}>

<TabItem value="inputs">

## Inputs

| Title          | Data Type | Description                                                                                           | Default Value | Notes                         |
| -------------- | --------- | ----------------------------------------------------------------------------------------------------- | ------------- | ----------------------------- |
| (custom names) | Any       | The input values passed into the code function. Dynamic based on the inputs configured in the editor. | `undefined`   | Always accepts any data type. |

</TabItem>

<TabItem value="outputs">

## Outputs

| Title          | Data Type | Description                                                           | Notes |
| -------------- | --------- | --------------------------------------------------------------------- | ----- |
| (custom names) | Any       | The outputs from the execution of the code block. Dynamic based on the | NOTES |

</TabItem>

<TabItem value="settings">

## Editor Settings

| Setting | Description                                                                                                                                                                                                                                 | Default Value                  | Use Input Toggle | Input Data Type |
| ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ | ---------------- | --------------- |
| Inputs  | The names of the inputs that can be accessible inside the code block. The names of the inputs configured here correspond with the properties of the provided `inputs` variable. Each input creates a corresponding input port on the block.   | A single input named `input`   | No               | N/A             |
| Outputs | The names of the outputs that the code block will return. The names of the outputs configured here must correspond with the properties of the object returned by the Code block. Each output creates a corresponding output port on the block. | A single output named `output` | No               | N/A             |

</TabItem>

</Tabs>

## Example 1: Use `.slice` to get a substring

1. Create a Code Block with the following code:

   ```js
   return {
     output: {
       type: 'string',
       value: inputs.input.value.slice(0, 5),
     },
   };
   ```

2. Create a Text block, give it the value `Hello World`, and connect it to the Code Block's `input` port.
3. Run the flow. Note that the Code Block's output is `Hello`.

![Code Block Example 1](./assets/code-block-example-01.png)

## Example 2: Concatenate two strings, and output the length and the string.

1. Create a Code Block with the following code:

   ```js
   const concatenated = inputs.input1.value + inputs.input2.value;
   return {
     length: {
       type: 'number',
       value: concatenated.length,
     },
     output: {
       type: 'string',
       value: concatenated,
     },
   };
   ```

2. Rename the existing input of the Code block to `input1`, and add a 2nd input to `input2`. Add a 2nd output named `length`.
3. Create two Text blocks, give them the values `Hello` and `World`, and connect them to the Code Block's `input1` and `input2` ports, respectively.
4. Run the flow. Note that the Code Block outputs `HelloWorld` and `10`.

![Code Block Example 2](./assets/code-block-example-02.png)

## Error Handling

If any error happens during the execution of the Code Block, then the block will error.

If you are unsure of the type of value passed into the code block, for example when reusing it in multiple places, you can and should check the `type` of the input before using it. For example:

```js
if (inputs.input.type === 'string') {
  // Do something with inputs.input.value
}
```

If you throw an `Error` in the code block, then it will error.

## FAQ

**Q: How is the code block implemented?**

A: The Code Block is implemented using a [Function constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/Function) with, as of right now, only one argument passed in to it - `inputs`. This is the same as if you were to write the following code:

```js
function codeBlock(inputs) {
  // Code here
}
```

**Q: Can I use `async`/`await` in the code block?**

A: No. The code block is executed synchronously, and does not support `async`/`await`. As you cannot use external libraries in a Code block, there is no need for `async`/`await` support anyway. Use an [External Call Block](./external-call.mdx) instead.

**Q: Can I use external libraries in the code block?**

A: No. The code block is executed in a sandboxed environment, and does not have access to external libraries. Use an [External Call Block](./external-call.mdx) instead.

**Q: Can I use `console.log` in the code block?**

A: No, the `console` variable is not available in a code block.

**Q: Can the code block function like an [If Block](./if.mdx)?**

A: Yes. If you return the special value `{ type: 'control-flow-excluded', value: undefined }` from the Code block, then the blocks after the Code block will be excluded from the flow's execution. This is useful if you want to conditionally execute a portion of the flow.

**Q: Is there any timeout? What if I create an infinite loop?**

A: There is no timeout. If you create an infinite loop, then the flow will hang indefinitely.

## See Also

- [External Call Block](./external-call.mdx)
