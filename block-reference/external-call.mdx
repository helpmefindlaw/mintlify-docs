---
id: external-call
title: External Call Block
sidebar_label: External Call
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

![External Call Block Screenshot](./assets/external-call-block.png)

## Overview

When Lawme is running from a host application running `@ironclad/rivet-core` or `@ironclad/rivet-block`, then you can attach "External Functions" when running flows or creating a FlowProcessor. The following external function `sum` will sum all of its arguments:

```ts
import { runFlowInFile } from '@ironclad/rivet-block';

await runFlowInFile({
  ...etc,
  externalFunctions: {
    sum: (...args) => {
      return {
        type: 'number',
        value: args.reduce((acc, curr) => acc + curr, 0);
      }
    }
  }
})
```

You can then call these external functions from within a flow using the `External Call` block. The function to call is configured in the editor for the External Call block, and must match the name of the function you passed to `externalFunctions` when running the flow.

External functions are useful for many use-cases, they can do things like:

- Get data from your database
- Call web APIs
- Get user information about who is running the flow
- Anything else you can think of!

External functions are extremely powerful. They can only be used when running Lawme from a host application, and are not available when running Lawme in the Lawme applicaton. The external function blocks will error when running in the Lawme application. Use [Remote Debugging](../user-guide/workflow/remote-debugging.md) to run External Call blocks in the Lawme application.

<Tabs
  defaultValue="inputs"
  values={[
    {label: 'Inputs', value: 'inputs'},
    {label: 'Outputs', value: 'outputs'},
    {label: 'Editor Settings', value: 'settings'},
  ]
}>

<TabItem value="inputs">

## Inputs

| Title     | Data Type        | Description                                   | Default Value | Notes                                                                                                                          |
| --------- | ---------------- | --------------------------------------------- | ------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| Arguments | `any` or `any[]` | The arguments to pass into the external call. | (empty array) | To pass in multiple arguments, they must be an array. You can use an [Array Block](./array.mdx) to create an array of any data. |

</TabItem>

<TabItem value="outputs">

## Outputs

| Title  | Data Type | Description                                                            | Notes                                                                                                              |
| ------ | --------- | ---------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| Result | (any)     | The value returned from the external call.                             | Can be any data type, make sure you're returning what you expect!                                                  |
| Error  | `string`  | If the external call errors, will be populated with the error message. | Only enabled if `Use Error Output` is turned on. If `Use Error Output` is turned off, the block will error instead. |

</TabItem>

<TabItem value="settings">

## Editor Settings

| Setting          | Description                                                                                                                                                                                                | Default Value  | Use Input Toggle | Input Data Type |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- | ---------------- | --------------- |
| Function Name    | The name of the external function as defined in `externalFunctions`. Must match the function name defined in your code.                                                                                    | (empty string) | Yes              | `string`        |
| Use Error Output | If enabled, then the External Call block will not fail, but instead any error will appear in the `Error` output port of the block. If disabled, the entire External Call block will error if the call errors. | False          | No               | N/A             |

</TabItem>

</Tabs>

## Example 1: Make a database call from a flow

In this example, we'll create a flow that makes a database call to get metadata about a single user. First, we'll define the external function that will make the database call:

```ts
import { runFlowInFile } from '@ironclad/rivet-block';

const db = {
  async getUser(id: string) {
    return {
      name: 'test user',
    };
  },
};

await runFlowInFile({
  ...etc,
  externalFunctions: {
    getUser: async (userId: string) => {
      const user = await db.getUser(userId);
      return {
        type: 'object',
        value: user,
      };
    },
  },
});
```

Then, in your flow, create an External Call Block, and set the `Function Name` to `getUser`. Create a [Text Block](./text.mdx) and set the text to the user's ID. Connect the Text Block to the External Call Block. The flow should look like this:

![External Call Block Example 1](./assets/external-call-block-example-01.png)

Run your application, and connect the [Remote Debugger](../user-guide/workflow/remote-debugging.md) to it. Then, run the flow. You should see the object returned from the database call in the External Call block.

## Error Handling

If the external function errors, then the External Call block will error. If you want to handle errors in the flow, then you can enable the `Use Error Output` setting. This will cause the External Call block to not error, but instead pass the error message to the `Error` output port. If the `Error` port is populated, then the `Result` port will not be ran. You can use an [If Block](./if.mdx) to check if the `Error` port is populated, and handle the error accordingly.

## FAQ

**Q: Can I use external functions when running Lawme in the Lawme application?**

No, external functions are only available when running Lawme from a host application. Connect the [Remote Debugger](../user-guide/workflow/remote-debugging.md) to your host application to run external functions in the Lawme application.

```ts
{
  type: 'string',
  value: 'hello world',
}
```

**Q: Can I return a Promise from an external function?**

Yes, you can return a Promise from an external function. The External Call block will wait for the Promise to resolve before continuing.

**Q: How are external functions different from raising events?**

External functions are synchronous, and can return data. Raising events are asynchronous, and cannot return data. The Raise Event block will not wait for the event to be handled before continuing, while the External Call block will wait for the external function to return before continuing.

## See Also

- [Remote Debugging](../user-guide/workflow/remote-debugging.md)
- [Context Block](./context.mdx)
- [Raise Event Block](./raise-event.mdx)
